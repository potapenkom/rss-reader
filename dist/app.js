!function(t){function e(e){for(var s,a,d=e[0],l=e[1],o=e[2],c=0,u=[];c<d.length;c++)a=d[c],n[a]&&u.push(n[a][0]),n[a]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);for(h&&h(e);u.length;)u.shift()();return r.push.apply(r,o||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],s=!0,d=1;d<i.length;d++){var l=i[d];0!==n[l]&&(s=!1)}s&&(r.splice(e--,1),t=a(a.s=i[0]))}return t}var s={},n={0:0},r=[];function a(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=s,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(i,s,function(e){return t[e]}.bind(null,s));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="./";var d=window.webpackJsonp=window.webpackJsonp||[],l=d.push.bind(d);d.push=e,d=d.slice();for(var o=0;o<d.length;o++)e(d[o]);var h=l;r.push([42,1]),i()}({16:function(t,e,i){var s=i(17);"string"==typeof s&&(s=[[t.i,s,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};i(18)(s,n);s.locals&&(t.exports=s.locals)},17:function(t,e,i){},42:function(t,e,i){"use strict";i.r(e);i(16),i(20);var s=i(13),n=i.n(s),r=i(14),a=i.n(r);class d{constructor(t){this.sender=t,this.listeners=[]}attach(t){this.listeners.push(t)}notify(t){this.listeners.forEach(e=>e(this.sender,t))}}var l=i(15),o=i.n(l),h=t=>{return o.a.get(`https://cors-anywhere.herokuapp.com/${t}`).then(({data:t})=>{return(new DOMParser).parseFromString(t,"application/xml")})};const c=t=>{const e=t.querySelector("channel"),i=e.querySelector("title"),s=e.querySelector("description");return{title:i.textContent,description:s.textContent}},u=t=>{return[...t.querySelector("channel").querySelectorAll("item")].map(t=>{const e=t.querySelector("title"),i=t.querySelector("link"),s=t.querySelector("description");return{title:e.textContent,description:s.textContent,link:i.textContent}})};class p{constructor(){this.formState="clean",this.feedList=new Map,this.articleList=new Map,this.addFeedEvent=new d(this),this.addArticlesEvent=new d(this),this.changeFormEvent=new d(this)}addFeed(t){this.formState="wait",this.changeFormEvent.notify(),h(t).then(e=>{const i=c(e),s=u(e);this.feedList.set(t,i),this.formState="clean",this.changeFormEvent.notify(),this.addFeedEvent.notify(),this.addArticles(s)}).catch(t=>{this.formState="error",this.changeFormEvent.notify(),console.log(t)})}addArticles(t){t.forEach(({link:t,title:e,description:i})=>this.articleList.set(t,{link:t,title:e,description:i})),this.addArticlesEvent.notify()}changeForm(t){if(t){const e=a()(t)&&this.isNotInList(t);this.formState=e?"valid":"non-valid",this.changeFormEvent.notify()}else this.formState="clean",this.changeFormEvent.notify()}getFeedList(){return[...this.feedList.values()]}getArticleList(){return[...this.articleList.values()]}getFeedUrlList(){return[...this.feedList.keys()]}isNotInList(t){return!this.getFeedUrlList().includes(t)}getFormState(){return this.formState}updateAllFeeds(){return this.getFeedUrlList().map(t=>(console.log(`Loading ${t}...`),h(t).then(e=>{const i=u(e),s=this.getArticleList(),r=n.a.differenceBy(i,s,"link");r.length>0&&this.addArticles(r),console.log(`${r.length} articles added from ${t}.`)}).catch(t=>console.log(t)).finally()))}}var m=i(1),f=i.n(m);class v{constructor(t){this.model=t,this.addFeedEvent=new d(this),this.addArticlesEvent=new d(this),this.changeFormEvent=new d(this),this.init()}init(){this.createChildren().setupHandlers().enable()}createChildren(){return this.$container=f()("#app"),this.$modal=f()("#descModal"),this.$form=this.$container.find("#inputForm"),this.$input=this.$container.find("#feedInput"),this.$feedList=this.$container.find("#feedList"),this.$articleList=this.$container.find("#articleList"),this}setupHandlers(){return this.addFeedButtonHandler=this.addFeedButton.bind(this),this.changeFormInputHadler=this.changeFormInput.bind(this),this.addFeedHandler=this.addFeed.bind(this),this.clearInputFieldHandler=this.clearInputField.bind(this),this.changeFormHadler=this.changeForm.bind(this),this}enable(){return this.$form.on("submit",t=>{t.preventDefault(),this.addFeedButtonHandler()}),this.$input.on("input",this.changeFormInputHadler),this.$modal.on("show.bs.modal",t=>{const e=f()(t.relatedTarget).data("description");this.$modal.find(".modal-body").text(e)}),this.model.addFeedEvent.attach(this.addFeedHandler),this.model.addFeedEvent.attach(this.clearInputFieldHandler),this.model.changeFormEvent.attach(this.changeFormHadler),this}addFeedButton(){this.addFeedEvent.notify({feedUrl:this.$input.val()})}changeFormInput(){this.changeFormEvent.notify({inputUrl:this.$input.val()})}buildFeedList(){const t=this.model.getFeedList().map(({title:t,description:e})=>`<li class='list-group-item'><h6 class="mb-1">${t}</h6>\n       <p class="small mb-1">${e}</p>\n      </li>`);this.$feedList.html(t.join(""))}buildArticlesList(){const t=this.model.getArticleList().map(({link:t,title:e,description:i})=>`<li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">\n      <a href="${t}" target="_blank">${e}</a>\n          <a href="#" \n            class="badge badge-light"\n            data-toggle="modal" \n            data-target="#descModal"\n            data-description="${i}">Description</a>\n      </li>`);this.$articleList.html(t.join(""))}clearInputField(){this.$input.val("")}addFeed(){this.buildFeedList()}addArticles(){this.buildArticlesList()}changeForm(){const t=this.model.getFormState();this.updateFormState(t)}updateFormState(t){const e=this.$form.find("#inputStatus"),i=this.$form.find("#submitButton"),s=this.$input;switch(t){case"clean":s.removeClass("is-valid"),s.removeClass("is-invalid"),s.prop("disabled",!1),e.text("Input URL-address"),e.removeClass("text-danger"),e.removeClass("text-success"),e.addClass("text-muted"),i.prop("disabled",!0),this.$form.val("");break;case"valid":s.removeClass("is-invalid"),s.addClass("is-valid"),e.text("Looks good!"),e.removeClass("text-muted"),e.removeClass("text-danger"),e.addClass("text-success"),i.prop("disabled",!1);break;case"non-valid":s.removeClass("is-valid"),s.addClass("is-invalid"),e.text("Invalid URL-address"),e.removeClass("text-muted"),e.removeClass("text-success"),e.addClass("text-danger"),i.prop("disabled",!0);break;case"wait":s.prop("disabled",!0),e.text("Loading new RSS feed..."),e.removeClass("text-danger"),e.removeClass("text-success"),e.addClass("text-muted"),i.prop("disabled",!0);break;case"error":s.addClass("is-invalid"),s.prop("disabled",!1),e.text("Can't load this URL. Bad address or no RSS-channel there."),e.removeClass("text-muted"),e.addClass("text-danger"),i.prop("disabled",!1)}}}class g{constructor(t,e){this.model=t,this.view=e}init(){this.setupHandlers().enable()}setupHandlers(){return this.addFeedHandler=this.addFeed.bind(this),this.addArticlesHandler=this.addArticles.bind(this),this.changeFormHandler=this.changeForm.bind(this),this}enable(){return this.view.addFeedEvent.attach(this.addFeedHandler),this.view.changeFormEvent.attach(this.changeFormHandler),this.model.addArticlesEvent.attach(this.addArticlesHandler),this}addFeed(t,e){this.model.addFeed(e.feedUrl)}changeForm(t,e){this.model.changeForm(e.inputUrl)}addArticles(){this.view.addArticles()}}(()=>{const t=new p,e=new v(t),i=new g(t,e),s=()=>{if(0===t.getFeedUrlList().length)setTimeout(s,5e3);else{const e=t.updateAllFeeds();Promise.all(e).then(()=>setTimeout(s,5e3))}};i.init(),s()})()}});